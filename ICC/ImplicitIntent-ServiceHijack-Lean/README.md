# Summary
Apps that contain a service that can be started via an implicit intent are vulnerable to Service Hijack attacks.

# Versions of Android where the vulnerability is possible
Android 4.4

# Description of the vulnerability and the corresponding exploit
*Description:* A service can be started via an implicit intent or an explicit intent. An explicit intent contains the package name and the class name of the
service that needs to be started so the Android system will always knwo which service to start. Implicit intents on the other hand have a
string identifier which the android system uses to resolve the service to start. This string identifier can correspond to more than one service.

*Issue:* A malicious app can contain a service with the same string identifier used to resolve a service in a benign app. When an implcit intent
is used to start the service in the benign app usin the string identifier, the android system will not know which service to start so it start
a service at random. The situation is more dangerous because a service can specify a priority. In case of a conflict like the one we are describing,
a service with the higher priority will be started. This means that a malicious service can specify a higher priority than the benign service
and hijack all communication to and from the benign service.

*Example:* The vulnerability is demonstrated by *Benign* and *Malicious*. The Benign app has a service *MyService*.
The Benign app uses an implicit intent to start *MyService*. The malicious app has a malicious service with the same string identifier or
*intent-filter* as the benign service but with a higher priority. When *Benign/MyService* is started then the service in the malicious app
will be started in its place.

# Steps to build the sample apps and to exploit the vulnerability

1. List targets:

    `$ android list targets`

2. List available Android Virtual Devices:

    `$ android list avd`

3. Create an emulator:

    `$ android create avd -n <name> -t <target>`

    *<target>* is obtained from the command listed in 1. *<name>* is the name you choose to give to the avd.

4. Start emulator:

    `$ emulator -avd <avd_name>`

    *<avd-name>* is obtained from the command listed in 2.

5. Build and install *Malicious*:

    `$ cd Malicious`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

6. Build and install *Benign*:

    `$ cd Benign`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

7. Open *Benign* in the emulator where you installed the app. A message will be displayed saying "Malicious service started".

# References

1.  [Analyzing Inter-Application Communication in Android - Erika Chin](http://dl.acm.org/citation.cfm?id=2000018)

2. [Official Android Documentation](https://developer.android.com/guide/components/intents-filters.html)
