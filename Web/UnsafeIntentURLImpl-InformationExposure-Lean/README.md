# Summary
Apps that do not safely handle an incoming intent embedded inside a URI are vulnerable to information exposure via intent hijacking.

# Android versions affected
Tested on Android 4.4 - Android 7.1

# Description of vulnerability and corresponding exploit
Android allows a webpage displayed in an Android app to launch an Android component via an intent. A webpage X needs to encode the intent as a valid URI U and load it into a component C that displays X. When the user interacts with the webpage X and takes an action that loads the resource pointed to by U.  

*Issue:* If an app has a component C that displays web pages and that component does not sanitize the URI before acting on it then a malicious web page could embed an intent to a malicious component installed in the device. When the user interacts with the URI, she ends up interacting with the malicious component.

*Example:* The vulnerability is demonstrated by *Benign* and *Malicious* and a malicious webpage in *Misc/LocalServer/templates/intentSender.html*. *Benign* is a simple browser which allows users to type in a URL and load a web page. *Misc/LocalServer/templates/intentSender.html* is a malicious webpage that contains a link with an intent to *Malicious/MainActivity.java*. *Benign* has a component *MyWebViewClient* that checks if an incoming URI contains an embedded intent. If it does then it starts the component that the intent points to and sends sensitive information to that component. If a user loads *Misc/LocalServer/templates/intentSender.html* and clicks on *Click Me* then sensitive information gets sent to *Malicious/MainActivity.java*.

# Steps to build the sample apps and to exploit the vulnerability

1. Setup a local Web Server. We have used Flask here. If you want to use Flask follow the instructions [here](https://bitbucket.org/secure-it-i/android-app-vulnerability-benchmarks/src/76cc87180f064b328c37cc57b5c743dba378a5de/Misc/LocalServer/README.md?at=master&fileviewer=file-view-default).

2. List targets:

    `$ android list targets`

3. List available Android Virtual Devices:

    `$ android list avd`

4. Create an emulator:

    `$ android create avd -n <name> -t <target>`

    *<target>* is obtained from the command listed in 1. *<name>* is the name you choose to give to the avd.

5. Start emulator:

    `$ emulator -avd <avd_name>`

    *<avd-name>* is obtained from the command listed in 3.


6. Build and install *Benign*:

    `$ cd Benign`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

7. Build and install *Malicious*:

    `$ cd Malicious`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

8. Open *Benign* and type the URL "http://serverIP:5000/intent/". Click on the link *Click Me*.

9. You will see the app *Malicious* launched and a toast with the message *Sensitive Information*.


# References

1. [Android Intents with Chrome](https://developer.chrome.com/multidevice/android/intents)

2. [Issue 55](https://bitbucket.org/secure-it-i/android-app-vulnerability-benchmarks/issues/55/explore-cve-2014-1506-to-add-new-lean-and)
