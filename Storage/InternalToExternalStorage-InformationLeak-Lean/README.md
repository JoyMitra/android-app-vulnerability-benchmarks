# Summary
Apps that allow files in internal storage to be downloaded to external storage are vulnerable to information leak.

# Versions of Android affected
Tested on Android 4.4 - 7.1

# Description of the vulnerability and the corresponding exploit

*Issue* : If an app has a component that takes internal file path as input from untrusted sources and writes writes its contents to external storage then the app is leaking information because then an attacker can craft a file path to download any file in internal storage to external storage. From external storage it can then read the downloaded files.

*Example* : We demonstrate how this is possible through two apps, *Benign* and *Malicious*. *Benign/DownloadService* takes file name as input and writes the file into external storage. *Malicious* sends an intent to *Benign/DownloadService* and embeds a file name that it wants to read from internal storage. *Benign/DownloadService* takes the file name, reads it and saves in the external storage thus leaking information.

# Steps to build the sample apps and to exploit the vulnerability

1. List targets:

    `$ android list targets`

2. List available Android Virtual Devices:

    `$ android list avd`

3. Create an emulator:

    `$ android create avd -n <name> -t <target>`

    *<target>* is obtained from the command listed in 1. *<name>* is the name you choose to give to the avd.

4. Start emulator:

    `$ emulator -avd <avd_name>`

    *<avd-name>* is obtained from the command listed in 2.

5. Build and install *Benign*:

    `$ cd Benign`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

6. Build and install *Malicious*:

    `$ cd Malicious`

    Make sure there is a file called local.properties with an entry sdk=/path/to/Android/sdk.

    `$ ./gradlew installDebug`

7.  Launch *Benign*. Edit the text field and click on *save* and *Download to sdcard*.

8. Launch *Malicious*.

9. Check logcat.

    `$ adb logcat -d | grep "Benign/DownloadService"`

    You should see a message that file was written to external storage successfully.

# References

1.  [Android Official Documentation](https://developer.android.com/guide/topics/data/data-storage.html#filesExternal)

2. [Issue 53](https://bitbucket.org/secure-it-i/android-app-vulnerability-benchmarks/issues/53/explore-cve-2014-1566-to-add-new-lean-and)
